#Gitその2

##コマンド

###ローカルリポジトリ作業

git revert {ハッシュ値}

指定したハッシュ値のコミットを打ち消す

git reset HEAD^

直前のコミットをなかったことにする

git reset --hard HEAD^

直前のコミットをなかったことにし、変更も全て元に戻す

git reset HEAD {ファイル名}

現在のコミットで変更した内容を元に戻す

git reset {ファイル名}

対象のファイルのステージを取り消す

git rebase -i {コミット位置指定}

対話的にコミットを書き換える

git commit --amend

直前のコミットをやり直す

git push {コピー先のリポジトリ} {コピー元のブランチ}

任意のブランチから指定のリポジトリへデータをコピー

git clone {コピー元のリポジトリ} {コピー先のリポジトリ}

コピー元のリポジトリから作業リポジトリを作成する

git pull

任意のリポジトリからデータを取得し、作業リポジトリと併合する

git --bare init

作業リポジトリを持たないリポジトリを初期化する

git checkout {ブランチ}

指定したブランチへ移動する

###共用リポジトリ作業

git --bare init --shared

複数のユーザーで共有するベアリポジトリを初期化して作成する

git branch

現在リポジトリ内にあるブランチとユーザーの現在地の確認

git checkout hoge

指定したブランチへ移動する

git merge hoge

現在のブランチに指定したブランチを併合する

git checkout -b hoge

新規ブランチを作成し新規ブランチへ移動する

git branch -D hoge

指定したブランチを削除する

git stash

コミットしてない変更を脇によけておく

git stash pop

git stashで脇によけた変更を復活させる

git rebase

差分をパッチ上にして上書きする

git rebase --continue

Conflictなどして止まったリベースを再開する

##手順

###変更を取り消す

git revert {ハッシュ値}でコミットを取り消す
+ なぜ取り消したかを記述して保存する

###変更を元に戻す

git reset HEAD^で直前のコミットの事実のみを捨てる
+ HEAD^は一つ前のコミットを指す

git reset --hard HEAD^で直前のコミットの事実だけでなく直前のコミットで変更した内容までリセットする

git reset HEAD {ファイル名}で現在のコミットで変更した内容を元に戻す

git reset {ファイル名}で対象のファイルのステージを取り消す
+ 引数によって動作が違う

git rebase -i {コミット位置指定}で対話的にコミットを書き換える
+ コミット位置は
+ HEAD~5 → HEAD~4 → HEAD~3 → HEAD~2 → HEAD~1 → HEAD(現在)

git commit --amendでコミットをやり直す
+ インデックスにステージしてからこのコマンドを実行すると変更を追加できる
+ コミットを何度してもログが増えない
+ ログメッセージのみの変更にも使える

###バックアップリポジトリ

バックアップリポジトリ名には{名前}.gitが慣例

git --bare initで初期化する
+ ベアリポジトリ(作業リポジトリを持たないリポジトリ)となる

git push {コピー先のリポジトリ} {コピー元のブランチ}で指定したブランチを任意のリポジトリに送信する

git clone {コピー元のリポジトリ} {コピー先のリポジトリ}でベアリポジトリをコピーした作業リポジトリを作成する

ここまでで
+ もともと作業していたリポジトリ
+ ベアリポジトリ
+ クローンした作業リポジトリ

ができた。クローンした作業リポジトリからのほうが保存が楽なのでもともと作業していたリポジトリは捨てていい

masterブランチからバックアップリポジトリへデータを保存する場合

git push origin master

と省略できる

###並行開発

SSH接続が利用できればgitclone {ホスト名}:{パス} {コピー先のリポジトリ}で作業リポジトリを作成できる

GitHubにリポジトリを準備してアクセスする手段もある

git pull origin masterでバックアップリポジトリからデータを取得し多少の差分はマージする

同じ行で変更が重複した場合はConflictしたというエラーが出る

<<<<<<< HEAD から ======= までがバックアップリポジトリでHEADだったコミットの内容でそこから >>>>>>> {ハッシュ値} までが更新しようとした内容


編集してログメッセージに残す

###タグ

git tag -a {タグの名前}でタグメッセージを編集できる

git tag
+ -lでタグの履歴を閲覧できる
+ -nでタグのコメントを閲覧できる

git describeでタグの検索ができる

###共用リポジトリ

1. 共用リポジトリを作成する(=バックアップリポジトリ)
2. 共用リポジトリからcloneし作業用リポジトリを作成する
3. 共用リポジトリから他のメンバーへの作業内容をpullする
4. 共用リポジトリへ自分の作業内容をpushする

作業メンバーが全員で共有できる位置に共用のバックアップリポジトリを作成する(GitHub,SSH接続できるサーバなど)

リポジトリ初期化時に--bareのオプションをつけるとその場所でコマンドを使用して作業できないため一度pushした履歴は書き換えられないため十分に精査されているべきとされている

